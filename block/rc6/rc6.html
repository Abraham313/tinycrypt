<h3><strong>Introduction</strong></h3>

<a href="http://people.csail.mit.edu/rivest/pubs/RRSY98.pdf">RC6</a> is a 20 round, 128-bit block cipher with support for 128, 192, 256-bit key sizes. It was designed by <a href="http://people.csail.mit.edu/rivest/">Ron Rivest</a>, Matthew Robshaw, Ray Sidney, <a href="http://people.csail.mit.edu/yiqun/">Yiqun Lisa Yin</a> and published in 1998. While selected as one of the five finalists considered for the Advanced Encryption Standard (AES), it lost out to Rijndael, perhaps due to poor performance. RC6 has a simple structure consisting of two Feistel networks whose data are mixed via <a href="https://patents.google.com/patent/US5835600">data-dependent rotations</a>. It's a more advanced version of RC5 that operates on four 32-bit words instead of two, and includes mitigations against attacks possible on RC5. The security of RC6 relies on the strength of data-dependent rotations, the mixed use of exclusive-or operations and modular additions.</a> As of February 13th 2019, the <a href="https://patents.google.com/patent/US5724428">patent has expired</a>.</p>

<h3><strong>Compact code</strong></h3>

<p>The following is not optimized for performance. It's a simplified version intended to be used as a reference.</p>

<pre style='color:#000000;background:#ffffff;'><span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> R</span><span style='color:#808030; '>(</span><span style='color:#004a43; '>v</span><span style='color:#808030; '>,</span><span style='color:#004a43; '>n</span><span style='color:#808030; '>)</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#004a43; '>v</span><span style='color:#808030; '>)</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>(</span><span style='color:#004a43; '>n</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>|</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#004a43; '>v</span><span style='color:#808030; '>)</span><span style='color:#808030; '>></span><span style='color:#808030; '>></span><span style='color:#808030; '>(</span><span style='color:#004a43; '>32</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span><span style='color:#004a43; '>n</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> F</span><span style='color:#808030; '>(</span><span style='color:#004a43; '>n</span><span style='color:#808030; '>)</span><span style='color:#004a43; '>for</span><span style='color:#808030; '>(</span><span style='color:#004a43; '>i</span><span style='color:#808030; '>=</span><span style='color:#004a43; '>0</span><span style='color:#808030; '>;</span><span style='color:#004a43; '>i</span><span style='color:#808030; '>&lt;</span><span style='color:#004a43; '>n</span><span style='color:#808030; '>;</span><span style='color:#004a43; '>i</span><span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
<span style='color:#800000; font-weight:bold; '>typedef</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>int</span> W<span style='color:#800080; '>;</span>

<span style='color:#800000; font-weight:bold; '>void</span> rc6<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>void</span><span style='color:#808030; '>*</span>mk<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>void</span><span style='color:#808030; '>*</span>p<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    W A<span style='color:#808030; '>=</span><span style='color:#008000; '>0xB7E15163</span><span style='color:#808030; '>,</span>B<span style='color:#808030; '>,</span>C<span style='color:#808030; '>,</span>D<span style='color:#808030; '>,</span>i<span style='color:#808030; '>,</span>X<span style='color:#808030; '>,</span>Y<span style='color:#808030; '>,</span>S<span style='color:#808030; '>[</span><span style='color:#008c00; '>44</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span>L<span style='color:#808030; '>[</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span><span style='color:#808030; '>*</span>x<span style='color:#808030; '>=</span>p<span style='color:#808030; '>,</span><span style='color:#808030; '>*</span>k<span style='color:#808030; '>=</span>mk<span style='color:#800080; '>;</span>

    <span style='color:#696969; '>// copy 256-bit key</span>
    F<span style='color:#808030; '>(</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span>L<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span>k<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>k<span style='color:#808030; '>=</span>S<span style='color:#800080; '>;</span>
    
    <span style='color:#696969; '>// initialize state</span>
    F<span style='color:#808030; '>(</span><span style='color:#008c00; '>44</span><span style='color:#808030; '>)</span>S<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span>A<span style='color:#808030; '>,</span>A<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#008000; '>0x9E3779B9</span><span style='color:#800080; '>;</span>
    A<span style='color:#808030; '>=</span>B<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
    
    <span style='color:#696969; '>// create subkeys</span>
    F<span style='color:#808030; '>(</span><span style='color:#008c00; '>44</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>)</span>
      A<span style='color:#808030; '>=</span>S<span style='color:#808030; '>[</span>i<span style='color:#808030; '>%</span><span style='color:#008c00; '>44</span><span style='color:#808030; '>]</span><span style='color:#808030; '>=</span>R<span style='color:#808030; '>(</span>S<span style='color:#808030; '>[</span>i<span style='color:#808030; '>%</span><span style='color:#008c00; '>44</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span>A<span style='color:#808030; '>+</span>B<span style='color:#808030; '>,</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>
      B<span style='color:#808030; '>=</span>L<span style='color:#808030; '>[</span>i<span style='color:#808030; '>%</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>]</span><span style='color:#808030; '>=</span>R<span style='color:#808030; '>(</span>L<span style='color:#808030; '>[</span>i<span style='color:#808030; '>%</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span>A<span style='color:#808030; '>+</span>B<span style='color:#808030; '>,</span>A<span style='color:#808030; '>+</span>B<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
      
    <span style='color:#696969; '>// load plaintext, add key</span>
    A<span style='color:#808030; '>=</span><span style='color:#808030; '>*</span>x<span style='color:#800080; '>;</span>B<span style='color:#808030; '>=</span>x<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>C<span style='color:#808030; '>=</span>x<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>D<span style='color:#808030; '>=</span>x<span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
    B<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#808030; '>*</span>k<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>D<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#808030; '>*</span>k<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>// apply 20 rounds of encryption</span>
    F<span style='color:#808030; '>(</span><span style='color:#008c00; '>20</span><span style='color:#808030; '>)</span>
      X<span style='color:#808030; '>=</span>R<span style='color:#808030; '>(</span>B<span style='color:#808030; '>*</span><span style='color:#808030; '>(</span>B<span style='color:#808030; '>+</span>B<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>
      Y<span style='color:#808030; '>=</span>R<span style='color:#808030; '>(</span>D<span style='color:#808030; '>*</span><span style='color:#808030; '>(</span>D<span style='color:#808030; '>+</span>D<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>
      A<span style='color:#808030; '>=</span>R<span style='color:#808030; '>(</span>A<span style='color:#808030; '>^</span>X<span style='color:#808030; '>,</span>Y<span style='color:#808030; '>)</span><span style='color:#808030; '>+</span><span style='color:#808030; '>*</span>k<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>,</span>
      C<span style='color:#808030; '>=</span>R<span style='color:#808030; '>(</span>C<span style='color:#808030; '>^</span>Y<span style='color:#808030; '>,</span>X<span style='color:#808030; '>)</span><span style='color:#808030; '>+</span><span style='color:#808030; '>*</span>k<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>,</span>
      X<span style='color:#808030; '>=</span>A<span style='color:#808030; '>,</span>A<span style='color:#808030; '>=</span>B<span style='color:#808030; '>,</span>B<span style='color:#808030; '>=</span>C<span style='color:#808030; '>,</span>C<span style='color:#808030; '>=</span>D<span style='color:#808030; '>,</span>D<span style='color:#808030; '>=</span>X<span style='color:#800080; '>;</span>
      
    <span style='color:#696969; '>// add key, store ciphertext</span>
    A<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#808030; '>*</span>k<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>C<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#808030; '>*</span>k<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
    <span style='color:#808030; '>*</span>x<span style='color:#808030; '>=</span>A<span style='color:#800080; '>;</span>x<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>=</span>B<span style='color:#800080; '>;</span>x<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>=</span>C<span style='color:#800080; '>;</span>x<span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#808030; '>=</span>D<span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>
</pre>

<h3><strong>Source</strong></h3>

<p>This, including test unit can be found here.</p>
