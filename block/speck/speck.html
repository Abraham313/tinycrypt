<h3><strong>Introduction</strong></h3>

<a href="https://eprint.iacr.org/2013/404">Speck</a> is a family of lightweight block ciphers publicly released by the <em>National Security Agency</em> (NSA) in June 2013. It's an ARX (add-rotate-xor) design optimized for performance in software implementations and has been suggested for use on resource constrained devices.

Speck supports a variety of block and key sizes. A block is always two words, but the words may be 16, 24, 32, 48 or 64 bits in size. The corresponding key is 2, 3 or 4 words. The round function consists of two rotations, adding the right word to the left word, xoring the key into the left word, then and xoring the left word to the right word. The number of rounds depends on the parameters selected.

There's some interesting speculation on the reasons for publishing Simon and Speck in post to a crypto mailing list <em><a href="http://www.metzdowd.com/pipermail/cryptography/2015-August/026312.html">Speculation on the origin of Speck and Simon</a></em>
 
There are 2 implementations provided here. 1 will use 64-bit block size, 128-bit key and 27 rounds since this all fits easily onto 32-bit mode of x86 architecture. The other uses 128-bit block size, 256-bit key and 34 rounds since this all fits easily onto x86-64 mode of x86 architecture.

<strong><h3>Key schedule</h3></strong>

<pre style='color:#000000;background:#ffffff;'><span style='color:#800000;font-weight:bold;'>void</span> speck64_setkey<span style='color:#808030;'>(</span><span style='color:#800000;font-weight:bold;'>const</span> <span style='color:#800000;font-weight:bold;'>void</span> <span style='color:#808030;'>*</span>in<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>void</span> <span style='color:#808030;'>*</span>out<span style='color:#808030;'>)</span>
<span style='color:#800080;'>{</span>
    uint32_t i<span style='color:#808030;'>,</span> t<span style='color:#808030;'>,</span> k0<span style='color:#808030;'>,</span> k1<span style='color:#808030;'>,</span> k2<span style='color:#808030;'>,</span> k3<span style='color:#800080;'>;</span>
    uint32_t <span style='color:#808030;'>*</span>k<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>uint32_t<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>in<span style='color:#800080;'>;</span>
    uint32_t <span style='color:#808030;'>*</span>ks<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>uint32_t<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>out<span style='color:#800080;'>;</span>
    
    <span style='color:#696969;'>// copy 128-bit key to local space</span>
    k0 <span style='color:#808030;'>=</span> k<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span> k1 <span style='color:#808030;'>=</span> k<span style='color:#808030;'>[</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
    k2 <span style='color:#808030;'>=</span> k<span style='color:#808030;'>[</span><span style='color:#008c00;'>2</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span> k3 <span style='color:#808030;'>=</span> k<span style='color:#808030;'>[</span><span style='color:#008c00;'>3</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>

    <span style='color:#696969;'>// expand 128-bit key into round keys</span>
    <span style='color:#800000;font-weight:bold;'>for</span> <span style='color:#808030;'>(</span>i<span style='color:#808030;'>=</span><span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>&lt;</span><span style='color:#008c00;'>27</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>+</span><span style='color:#808030;'>+</span><span style='color:#808030;'>)</span>
    <span style='color:#800080;'>{</span>
      ks<span style='color:#808030;'>[</span>i<span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> k0<span style='color:#800080;'>;</span>
      
      k1 <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span>ROTR32<span style='color:#808030;'>(</span>k1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>+</span> k0<span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> i<span style='color:#800080;'>;</span>
      k0 <span style='color:#808030;'>=</span> ROTL32<span style='color:#808030;'>(</span>k0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> k1<span style='color:#800080;'>;</span>
      
      <span style='color:#696969;'>// rotate left 32-bits</span>
      XCHG<span style='color:#808030;'>(</span>k3<span style='color:#808030;'>,</span> k2<span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
      XCHG<span style='color:#808030;'>(</span>k3<span style='color:#808030;'>,</span> k1<span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
    <span style='color:#800080;'>}</span>
<span style='color:#800080;'>}</span>
</pre>

x86 assembly

<pre style='color:#000000;background:#ffffff;'><span style='color:#004a43;'>%define</span><span style='color:#004a43;'> SPECK_RNDS 27</span>
    
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> k0 eax    </span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> k1 ebx    </span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> k2 ebp    </span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> k3 edx</span>
    
<span style='color:#e34adc;'>speck_setkeyx:</span>
<span style='color:#e34adc;'>_speck_setkeyx:</span>
    <span style='color:#800000;font-weight:bold;'>pushad</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>esi</span><span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>esp</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>32</span><span style='color:#008c00;'>+4</span><span style='color:#808030;'>]</span>   <span style='color:#696969;'>; esi = in</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>edi</span><span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>esp</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>32</span><span style='color:#008c00;'>+8</span><span style='color:#808030;'>]</span>   <span style='color:#696969;'>; edi = ks</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> k3
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> k1
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> k2
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> k3
    <span style='color:#800000;font-weight:bold;'>xor</span>    <span style='color:#000080;'>ecx</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ecx</span>
<span style='color:#e34adc;'>spk_sk:</span>
    <span style='color:#696969;'>; ((uint32_t*)ks)[i] = k0;</span>
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#696969;'>; k1 = (ROTR32(k1, 8) + k0) ^ i;</span>
    <span style='color:#800000;font-weight:bold;'>ror</span>    k1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    k1<span style='color:#808030;'>,</span> k0
    <span style='color:#800000;font-weight:bold;'>xor</span>    k1<span style='color:#808030;'>,</span> <span style='color:#000080;'>ecx</span>
    <span style='color:#696969;'>; k0 = ROTL32(k0, 3) ^ k1;</span>
    <span style='color:#800000;font-weight:bold;'>rol</span>    k0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    k0<span style='color:#808030;'>,</span> k1
    <span style='color:#696969;'>; rotate left 32-bits</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   k3<span style='color:#808030;'>,</span> k2
    <span style='color:#800000;font-weight:bold;'>xchg</span>   k3<span style='color:#808030;'>,</span> k1
    <span style='color:#696969;'>; i++</span>
    <span style='color:#800000;font-weight:bold;'>inc</span>    <span style='color:#000080;'>ecx</span>
    <span style='color:#800000;font-weight:bold;'>cmp</span>    <span style='color:#000080;'>cl</span><span style='color:#808030;'>,</span> SPECK_RNDS    
    <span style='color:#800000;font-weight:bold;'>jnz</span>    <span style='color:#e34adc;'>spk_sk</span>   
    <span style='color:#800000;font-weight:bold;'>popad</span>
    <span style='color:#800000;font-weight:bold;'>ret</span>
</pre>

<h3><strong>Encryption/Decryption</strong></h3>

<pre style='color:#000000;background:#ffffff;'><span style='color:#800000;font-weight:bold;'>void</span> speck64_encrypt<span style='color:#808030;'>(</span><span style='color:#800000;font-weight:bold;'>const</span> <span style='color:#800000;font-weight:bold;'>void</span> <span style='color:#808030;'>*</span>keys<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>int</span> enc<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>void</span> <span style='color:#808030;'>*</span>data<span style='color:#808030;'>)</span>
<span style='color:#800080;'>{</span>
    uint32_t i<span style='color:#808030;'>,</span> x0<span style='color:#808030;'>,</span> x1<span style='color:#800080;'>;</span>
    uint32_t <span style='color:#808030;'>*</span>ks<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>uint32_t<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>keys<span style='color:#800080;'>;</span>
    uint32_t <span style='color:#808030;'>*</span>x<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>uint32_t<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>data<span style='color:#800080;'>;</span>
    
    <span style='color:#696969;'>// copy input to local space</span>
    x0<span style='color:#808030;'>=</span>x<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span> x1<span style='color:#808030;'>=</span>x<span style='color:#808030;'>[</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
    
    <span style='color:#800000;font-weight:bold;'>for</span> <span style='color:#808030;'>(</span>i<span style='color:#808030;'>=</span><span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>&lt;</span><span style='color:#008c00;'>27</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>+</span><span style='color:#808030;'>+</span><span style='color:#808030;'>)</span>
    <span style='color:#800080;'>{</span>
      <span style='color:#800000;font-weight:bold;'>if</span> <span style='color:#808030;'>(</span>enc<span style='color:#808030;'>=</span><span style='color:#808030;'>=</span>SPECK_DECRYPT<span style='color:#808030;'>)</span>
      <span style='color:#800080;'>{</span>
        x1 <span style='color:#808030;'>=</span> ROTR32<span style='color:#808030;'>(</span>x1 <span style='color:#808030;'>^</span> x0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
        x0 <span style='color:#808030;'>=</span> ROTL32<span style='color:#808030;'>(</span><span style='color:#808030;'>(</span>x0 <span style='color:#808030;'>^</span> ks<span style='color:#808030;'>[</span><span style='color:#008c00;'>27</span><span style='color:#808030;'>-</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>-</span>i<span style='color:#808030;'>]</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>-</span> x1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>        
      <span style='color:#800080;'>}</span> <span style='color:#800000;font-weight:bold;'>else</span> <span style='color:#800080;'>{</span>
        x0 <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span>ROTR32<span style='color:#808030;'>(</span>x0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>+</span> x1<span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> ks<span style='color:#808030;'>[</span>i<span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
        x1 <span style='color:#808030;'>=</span> ROTL32<span style='color:#808030;'>(</span>x1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> x0<span style='color:#800080;'>;</span>
      <span style='color:#800080;'>}</span>
    <span style='color:#800080;'>}</span>
    <span style='color:#696969;'>// save result</span>
    x<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> x0<span style='color:#800080;'>;</span> x<span style='color:#808030;'>[</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> x1<span style='color:#800080;'>;</span>
<span style='color:#800080;'>}</span>
</pre>

x86 assembly

<pre style='color:#000000;background:#ffffff;'><span style='color:#004a43;'>%define</span><span style='color:#004a43;'> x0 eax    </span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> x1 ebx</span>
    
<span style='color:#e34adc;'>speck_encryptx:</span>
<span style='color:#e34adc;'>_speck_encryptx:</span>
    <span style='color:#800000;font-weight:bold;'>pushad</span>
    <span style='color:#800000;font-weight:bold;'>lea</span>    <span style='color:#000080;'>esi</span><span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>esp</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>32</span><span style='color:#008c00;'>+4</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>edi</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>          <span style='color:#696969;'>; edi = ks</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ecx</span>          <span style='color:#696969;'>; ecx = enc</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>esi</span>          <span style='color:#696969;'>; esi = in</span>
    <span style='color:#800000;font-weight:bold;'>push</span>   <span style='color:#000080;'>esi</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>    
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> x1
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> x1
    <span style='color:#800000;font-weight:bold;'>test</span>   <span style='color:#000080;'>ecx</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ecx</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>cl</span><span style='color:#808030;'>,</span> SPECK_RNDS
    <span style='color:#800000;font-weight:bold;'>jz</span>     <span style='color:#e34adc;'>spk_e0</span>
<span style='color:#e34adc;'>spk_d0:</span>
    <span style='color:#696969;'>; x1 = ROTR32(x1 ^ x0, 3);</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    x1<span style='color:#808030;'>,</span> x0
    <span style='color:#800000;font-weight:bold;'>ror</span>    x1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span>
    <span style='color:#696969;'>; x0 = ROTL32((x0 ^ ks[SPECK_RNDS-1-i]) - x1, 8);</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    x0<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>edi</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>*</span><span style='color:#000080;'>ecx</span><span style='color:#808030;'>-</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>sub</span>    x0<span style='color:#808030;'>,</span> x1
    <span style='color:#800000;font-weight:bold;'>rol</span>    x0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span>
    <span style='color:#800000;font-weight:bold;'>loop</span>   <span style='color:#e34adc;'>spk_d0</span>
    <span style='color:#800000;font-weight:bold;'>jmp</span>    <span style='color:#e34adc;'>spk_end</span>    
<span style='color:#e34adc;'>spk_e0:</span>
    <span style='color:#696969;'>; x0 = (ROTR32(x0, 8) + x1) ^ ks[i];</span>
    <span style='color:#800000;font-weight:bold;'>ror</span>    x0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    x0<span style='color:#808030;'>,</span> x1
    <span style='color:#800000;font-weight:bold;'>xor</span>    x0<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>edi</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>scasd</span>
    <span style='color:#696969;'>; x1 = ROTL32(x1, 3) ^ x0;</span>
    <span style='color:#800000;font-weight:bold;'>rol</span>    x1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    x1<span style='color:#808030;'>,</span> x0
    <span style='color:#800000;font-weight:bold;'>loop</span>   <span style='color:#e34adc;'>spk_e0</span>
<span style='color:#e34adc;'>spk_end:</span>
    <span style='color:#800000;font-weight:bold;'>pop</span>    <span style='color:#000080;'>edi</span>
    <span style='color:#696969;'>; ((uint32_t*)in)[0] = x0;</span>
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> x1
    <span style='color:#696969;'>; ((uint32_t*)in)[1] = x1;</span>
    <span style='color:#800000;font-weight:bold;'>stosd</span>    
    <span style='color:#800000;font-weight:bold;'>popad</span>
    <span style='color:#800000;font-weight:bold;'>ret</span>
</pre>

<h3><strong>Just encryption</strong></h3>

Most block ciphers are used with Counter Mode (CTR) which turns a block cipher into a stream cipher. Here's the function with key scheduling and encryption integrated.

<pre style='color:#000000;background:#ffffff;'><span style='color:#800000;font-weight:bold;'>void</span> speck64_encryptx<span style='color:#808030;'>(</span><span style='color:#800000;font-weight:bold;'>const</span> <span style='color:#800000;font-weight:bold;'>void</span> <span style='color:#808030;'>*</span>key<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>void</span> <span style='color:#808030;'>*</span>data<span style='color:#808030;'>)</span>
<span style='color:#800080;'>{</span>
    uint32_t i<span style='color:#808030;'>,</span> t<span style='color:#808030;'>,</span> k0<span style='color:#808030;'>,</span> k1<span style='color:#808030;'>,</span> k2<span style='color:#808030;'>,</span> k3<span style='color:#808030;'>,</span> x0<span style='color:#808030;'>,</span> x1<span style='color:#800080;'>;</span>
    uint32_t <span style='color:#808030;'>*</span>k<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>uint32_t<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>key<span style='color:#800080;'>;</span>
    uint32_t <span style='color:#808030;'>*</span>x<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>uint32_t<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>data<span style='color:#800080;'>;</span>
    
    <span style='color:#696969;'>// copy 128-bit key to local space</span>
    k0 <span style='color:#808030;'>=</span> k<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span> k1 <span style='color:#808030;'>=</span> k<span style='color:#808030;'>[</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
    k2 <span style='color:#808030;'>=</span> k<span style='color:#808030;'>[</span><span style='color:#008c00;'>2</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span> k3 <span style='color:#808030;'>=</span> k<span style='color:#808030;'>[</span><span style='color:#008c00;'>3</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
    
    <span style='color:#696969;'>// copy input to local space</span>
    x0 <span style='color:#808030;'>=</span> x<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span> x1 <span style='color:#808030;'>=</span> x<span style='color:#808030;'>[</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
    
    <span style='color:#800000;font-weight:bold;'>for</span> <span style='color:#808030;'>(</span>i<span style='color:#808030;'>=</span><span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>&lt;</span><span style='color:#008c00;'>27</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>+</span><span style='color:#808030;'>+</span><span style='color:#808030;'>)</span>
    <span style='color:#800080;'>{</span>
      <span style='color:#696969;'>// encrypt block</span>
      x0 <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span>ROTR32<span style='color:#808030;'>(</span>x0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>+</span> x1<span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> k0<span style='color:#800080;'>;</span>
      x1 <span style='color:#808030;'>=</span>  ROTL32<span style='color:#808030;'>(</span>x1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> x0<span style='color:#800080;'>;</span>
      
      <span style='color:#696969;'>// create next sub key</span>
      t  <span style='color:#808030;'>=</span> k3<span style='color:#800080;'>;</span>
      k3 <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span>ROTR32<span style='color:#808030;'>(</span>k1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>+</span> k0<span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> i<span style='color:#800080;'>;</span>
      k0 <span style='color:#808030;'>=</span>  ROTL32<span style='color:#808030;'>(</span>k0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> k3<span style='color:#800080;'>;</span>
      
      k1 <span style='color:#808030;'>=</span> k2<span style='color:#800080;'>;</span>
      k2 <span style='color:#808030;'>=</span> t<span style='color:#800080;'>;</span>   
    <span style='color:#800080;'>}</span>
    <span style='color:#696969;'>// save result</span>
    x<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> x0<span style='color:#800080;'>;</span> x<span style='color:#808030;'>[</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> x1<span style='color:#800080;'>;</span>
<span style='color:#800080;'>}</span>
</pre>

x86 assembly..

<pre style='color:#000000;background:#ffffff;'><span style='color:#e34adc;'>speck64_encryptx:</span>
<span style='color:#e34adc;'>_speck64_encryptx:</span>    
    <span style='color:#800000;font-weight:bold;'>pushad</span>    
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>esi</span><span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>esp</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>32</span><span style='color:#008c00;'>+8</span><span style='color:#808030;'>]</span>   <span style='color:#696969;'>; esi = in</span>
    <span style='color:#800000;font-weight:bold;'>push</span>   <span style='color:#000080;'>esi</span>               <span style='color:#696969;'>; save</span>
    
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> x0           <span style='color:#696969;'>; x0 = in[0]</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> x1           <span style='color:#696969;'>; x1 = in[1]</span>
    
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>esi</span><span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>esp</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>32</span><span style='color:#008c00;'>+8</span><span style='color:#808030;'>]</span>   <span style='color:#696969;'>; esi = key</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> k0           <span style='color:#696969;'>; k0 = key[0] </span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> k1           <span style='color:#696969;'>; k1 = key[1]</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> k2           <span style='color:#696969;'>; k2 = key[2]</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span> 
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> k3           <span style='color:#696969;'>; k3 = key[3]    </span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>          <span style='color:#696969;'>; i = 0</span>
<span style='color:#e34adc;'>spk_el:</span>
    <span style='color:#696969;'>; x0 = (ROTR32(x0, 8) + x1) ^ k0;</span>
    <span style='color:#800000;font-weight:bold;'>ror</span>    x0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    x0<span style='color:#808030;'>,</span> x1
    <span style='color:#800000;font-weight:bold;'>xor</span>    x0<span style='color:#808030;'>,</span> k0
    <span style='color:#696969;'>; x1 = ROTL32(x1, 3) ^ x0;</span>
    <span style='color:#800000;font-weight:bold;'>rol</span>    x1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    x1<span style='color:#808030;'>,</span> x0
    <span style='color:#696969;'>; k1 = (ROTR32(k1, 8) + k0) ^ i;</span>
    <span style='color:#800000;font-weight:bold;'>ror</span>    k1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    k1<span style='color:#808030;'>,</span> k0
    <span style='color:#800000;font-weight:bold;'>xor</span>    k1<span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>
    <span style='color:#696969;'>; k0 = ROTL32(k0, 3) ^ k1;</span>
    <span style='color:#800000;font-weight:bold;'>rol</span>    k0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    k0<span style='color:#808030;'>,</span> k1    
    <span style='color:#800000;font-weight:bold;'>xchg</span>   k3<span style='color:#808030;'>,</span> k2
    <span style='color:#800000;font-weight:bold;'>xchg</span>   k3<span style='color:#808030;'>,</span> k1
    <span style='color:#696969;'>; i++</span>
    <span style='color:#800000;font-weight:bold;'>inc</span>    <span style='color:#000080;'>eax</span>
    <span style='color:#800000;font-weight:bold;'>cmp</span>    <span style='color:#000080;'>al</span><span style='color:#808030;'>,</span> SPECK_RNDS    
    <span style='color:#800000;font-weight:bold;'>jnz</span>    <span style='color:#e34adc;'>spk_el</span>
    
    <span style='color:#800000;font-weight:bold;'>pop</span>    <span style='color:#000080;'>edi</span>    
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> x0
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> x1
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#800000;font-weight:bold;'>popad</span>
    <span style='color:#800000;font-weight:bold;'>ret</span>
</pre>

The x86-64 version to support 256-bit keys and 128-bit blocks is only 24 bytes more.

<pre style='color:#000000;background:#ffffff;'><span style='color:#696969;'>;</span>
<span style='color:#696969;'>; speck128/256 encryption in 88 bytes</span>
<span style='color:#696969;'>;</span>
<span style='color:#004a43;'>%ifndef</span><span style='color:#004a43;'> BIN</span>
    <span style='color:#004a43;'>global</span> speck128_encryptx
<span style='color:#004a43;'>%endif</span>

<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> k0 rdi    </span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> k1 rbp    </span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> k2 rsi    </span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> k3 rcx</span>

<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> x0 rbx    </span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> x1 rdx</span>

<span style='color:#e34adc;'>speck128_encryptx:</span>   
    <span style='color:#800000;font-weight:bold;'>push</span>   rbp
    <span style='color:#800000;font-weight:bold;'>push</span>   rbx
    <span style='color:#800000;font-weight:bold;'>push</span>   rdi
    <span style='color:#800000;font-weight:bold;'>push</span>   rsi   

    <span style='color:#800000;font-weight:bold;'>mov</span>    k0<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>rcx   <span style='color:#808030;'>]</span>      <span style='color:#696969;'>; k0 = key[0]</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    k1<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>rcx<span style='color:#808030;'>+</span> <span style='color:#008c00;'>8</span><span style='color:#808030;'>]</span>      <span style='color:#696969;'>; k1 = key[1]</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    k2<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>rcx<span style='color:#808030;'>+</span><span style='color:#008c00;'>16</span><span style='color:#808030;'>]</span>      <span style='color:#696969;'>; k2 = key[2]</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    k3<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>rcx<span style='color:#808030;'>+</span><span style='color:#008c00;'>24</span><span style='color:#808030;'>]</span>      <span style='color:#696969;'>; k3 = key[3]</span>
    
    <span style='color:#800000;font-weight:bold;'>push</span>   rdx
    <span style='color:#800000;font-weight:bold;'>mov</span>    x0<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>rdx  <span style='color:#808030;'>]</span>       <span style='color:#696969;'>; x0 = in[0]</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    x1<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>rdx<span style='color:#808030;'>+</span><span style='color:#008c00;'>8</span><span style='color:#808030;'>]</span>       <span style='color:#696969;'>; x1 = in[1] </span>
    
    <span style='color:#800000;font-weight:bold;'>xor</span>    <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>          <span style='color:#696969;'>; i = 0</span>
<span style='color:#e34adc;'>spk_el:</span>
    <span style='color:#696969;'>; x1 = (ROTR64(x1, 8) + x0) ^ k0;</span>
    <span style='color:#800000;font-weight:bold;'>ror</span>    x1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    x1<span style='color:#808030;'>,</span> x0
    <span style='color:#800000;font-weight:bold;'>xor</span>    x1<span style='color:#808030;'>,</span> k0
    <span style='color:#696969;'>; x0 =  ROTL64(x0, 3) ^ x1;</span>
    <span style='color:#800000;font-weight:bold;'>rol</span>    x0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    x0<span style='color:#808030;'>,</span> x1
    <span style='color:#696969;'>; k1 = (ROTR64(k1, 8) + k0) ^ i;</span>
    <span style='color:#800000;font-weight:bold;'>ror</span>    k1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    k1<span style='color:#808030;'>,</span> k0
    <span style='color:#800000;font-weight:bold;'>xor</span>    k1<span style='color:#808030;'>,</span> rax
    <span style='color:#696969;'>; k0 = ROTL64(k0, 3) ^ k1;</span>
    <span style='color:#800000;font-weight:bold;'>rol</span>    k0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    k0<span style='color:#808030;'>,</span> k1
    
    <span style='color:#800000;font-weight:bold;'>xchg</span>   k3<span style='color:#808030;'>,</span> k2
    <span style='color:#800000;font-weight:bold;'>xchg</span>   k3<span style='color:#808030;'>,</span> k1
    <span style='color:#696969;'>; i++</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    <span style='color:#000080;'>al</span><span style='color:#808030;'>,</span> <span style='color:#008c00;'>1</span>
    <span style='color:#800000;font-weight:bold;'>cmp</span>    <span style='color:#000080;'>al</span><span style='color:#808030;'>,</span> SPECK_RNDS    
    <span style='color:#800000;font-weight:bold;'>jnz</span>    <span style='color:#e34adc;'>spk_el</span>
    
    <span style='color:#800000;font-weight:bold;'>pop</span>    rax
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#808030;'>[</span>rax  <span style='color:#808030;'>]</span><span style='color:#808030;'>,</span> x0
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#808030;'>[</span>rax<span style='color:#808030;'>+</span><span style='color:#008c00;'>8</span><span style='color:#808030;'>]</span><span style='color:#808030;'>,</span> x1
    
    <span style='color:#800000;font-weight:bold;'>pop</span>    rsi
    <span style='color:#800000;font-weight:bold;'>pop</span>    rdi
    <span style='color:#800000;font-weight:bold;'>pop</span>    rbx
    <span style='color:#800000;font-weight:bold;'>pop</span>    rbp
    <span style='color:#800000;font-weight:bold;'>ret</span>
</pre>

And here's some ARMv6 assembly to finish with.

<pre style='color:#000000;background:#ffffff;'><span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> key
k0 .req r2
k1 .req r3
k2 .req r4
k3 .req r5

<span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> plaintext
x0 .req r6
x1 .req r7

<span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> parameters
k  .req r0
x  .req r1
i  .req r0
t  .req r8

  <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> speck64_encryptx<span style='color:#808030;'>(</span>void <span style='color:#808030;'>*</span>key<span style='color:#808030;'>,</span> void <span style='color:#808030;'>*</span><span style='color:#004a43;'>data</span><span style='color:#808030;'>)</span><span style='color:#696969;'>;</span>
<span style='color:#e34adc;'>speck64_encryptx:</span>
  <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> save registers
  <span style='color:#800000;font-weight:bold;'>push</span>   <span style='color:#808030;'>{</span>r0<span style='color:#808030;'>-</span>r1<span style='color:#008c00;'>2</span><span style='color:#808030;'>,</span>lr<span style='color:#808030;'>}</span>
  
  <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> load <span style='color:#008c00;'>128</span><span style='color:#808030;'>-</span>bit key
  <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> k0 <span style='color:#808030;'>=</span> k<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span><span style='color:#696969;'>; k1 = k[1]; k2 = k[2]; k3 = k[3];</span>
  ldm    k<span style='color:#808030;'>,</span> <span style='color:#808030;'>{</span>k0<span style='color:#808030;'>,</span> k1<span style='color:#808030;'>,</span> k2<span style='color:#808030;'>,</span> k3<span style='color:#808030;'>}</span>
  ldm    x<span style='color:#808030;'>,</span> <span style='color:#808030;'>{</span>x0<span style='color:#808030;'>,</span> x1<span style='color:#808030;'>}</span>          <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> x0 <span style='color:#808030;'>=</span> x<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span><span style='color:#696969;'>; x1 = k[1];</span>
  <span style='color:#800000;font-weight:bold;'>mov</span>    i<span style='color:#808030;'>,</span> #<span style='color:#008c00;'>0</span>                <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> i<span style='color:#808030;'>=</span><span style='color:#008c00;'>0</span>
<span style='color:#e34adc;'>speck_loop:</span>
  <span style='color:#800000;font-weight:bold;'>add</span>    x0<span style='color:#808030;'>,</span> x1<span style='color:#808030;'>,</span> x0<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>ror</span> #<span style='color:#008c00;'>8</span>   <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> x0 <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span>ROTR3<span style='color:#008c00;'>2</span><span style='color:#808030;'>(</span>x0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>+</span> x1<span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> k0<span style='color:#696969;'>;</span>
  eor    x0<span style='color:#808030;'>,</span> x0<span style='color:#808030;'>,</span> k0           <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span>
  eor    x1<span style='color:#808030;'>,</span> x0<span style='color:#808030;'>,</span> x1<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>ror</span> #<span style='color:#008c00;'>29</span>  <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> x1 <span style='color:#808030;'>=</span> ROTL3<span style='color:#008c00;'>2</span><span style='color:#808030;'>(</span>x1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> x0<span style='color:#696969;'>;</span>
  <span style='color:#800000;font-weight:bold;'>mov</span>    t<span style='color:#808030;'>,</span> k3                <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> backup k3
  <span style='color:#800000;font-weight:bold;'>add</span>    k3<span style='color:#808030;'>,</span> k0<span style='color:#808030;'>,</span> k1<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>ror</span> #<span style='color:#008c00;'>8</span>   <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> k3 <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span>ROTR3<span style='color:#008c00;'>2</span><span style='color:#808030;'>(</span>k1<span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>+</span> k0<span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> i<span style='color:#696969;'>;</span>
  eor    k3<span style='color:#808030;'>,</span> k3<span style='color:#808030;'>,</span> i            <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span>
  eor    k0<span style='color:#808030;'>,</span> k3<span style='color:#808030;'>,</span> k0<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>ror</span> #<span style='color:#008c00;'>29</span>  <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> k0 <span style='color:#808030;'>=</span> ROTL3<span style='color:#008c00;'>2</span><span style='color:#808030;'>(</span>k0<span style='color:#808030;'>,</span> <span style='color:#008c00;'>3</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>^</span> k3<span style='color:#696969;'>;</span>
  <span style='color:#800000;font-weight:bold;'>mov</span>    k1<span style='color:#808030;'>,</span> k2               <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> k1 <span style='color:#808030;'>=</span> k2<span style='color:#696969;'>;</span>
  <span style='color:#800000;font-weight:bold;'>mov</span>    k2<span style='color:#808030;'>,</span> t                <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> k2 <span style='color:#808030;'>=</span> t<span style='color:#696969;'>;</span>
  <span style='color:#800000;font-weight:bold;'>add</span>    i<span style='color:#808030;'>,</span> i<span style='color:#808030;'>,</span> #<span style='color:#008c00;'>1</span>             <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> i<span style='color:#808030;'>+</span><span style='color:#808030;'>+</span><span style='color:#696969;'>;</span>
  <span style='color:#800000;font-weight:bold;'>cmp</span>    i<span style='color:#808030;'>,</span> #<span style='color:#008c00;'>27</span>               <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> i<span style='color:#808030;'>&lt;</span><span style='color:#008c00;'>27</span><span style='color:#696969;'>;</span>
  bne    speck_loop
  
  <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> save result
  stm    x<span style='color:#808030;'>,</span> <span style='color:#808030;'>{</span>x0<span style='color:#808030;'>,</span> x1<span style='color:#808030;'>}</span>          <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> x<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> x0<span style='color:#696969;'>; x[1] = x1;</span>
  
  <span style='color:#808030;'>/</span><span style='color:#808030;'>/</span> restore registers
  <span style='color:#800000;font-weight:bold;'>pop</span>    <span style='color:#808030;'>{</span>r0<span style='color:#808030;'>-</span>r1<span style='color:#008c00;'>2</span><span style='color:#808030;'>,</span>pc<span style='color:#808030;'>}</span>
</pre>

<h3><strong>Summary</strong></h3>

<table>
  <tr>
    <th>instruction set</th>
    <th>setkey + encrypt + decrypt (bytes)<br></th>
    <th>setkey + encrypt (bytes)</th>
  </tr>
  <tr>
    <td>x86</td>
    <td>105</td>
    <td>64<br></td>
  </tr>
  <tr>
    <td>x86-64</td>
    <td>132</td>
    <td>86</td>
  </tr>
</table> 

MSVC generated code is 139 bytes using /O2 /Os flags. x86 assembly is 105 bytes for enc+dec or 64 bytes for just enc. Nice algorithm that would be fun for those new to cryptography. Not suggesting it's secure though.

<a href="https://github.com/odzhan/tinycrypt/tree/master/block/speck">See sources here</a>
