<strong>Introduction</strong>

<a href="https://cr.yp.to/snuffle.html">Salsa20 or Snuffle 2005</a> is a stream cipher designed, written and published in 2005 by mathematician <a href="https://cr.yp.to/djb.html">D.J Bernstein</a>. It supports 128/256-bit keys and 64-bit nonce values. 

Another version <a href="https://cr.yp.to/snuffle/xsalsa-20110204.pdf">XSalsa20</a> supports nonces up to 192-bits if 64-bits is insufficient to what you need.

It was selected for the final portfolio of the <a href="http://www.ecrypt.eu.org/stream/">eStream (ECRYPT Stream Cipher Project)</a> so we can presume it's undergone extensive cryptanalysis during the selection process.

The implementation here only supports 256-bit keys.

<strong>About the assembly code</strong>

<a href="https://tinycrypt.wordpress.com/2015/12/04/asmcodes-chacha20/">ChaCha20</a> was already implemented and is based on Salsa20 although ChaCha20 is apparently a better design for performance without losing security. The x86 code was a joint effort between <a href="http://pferrie.host22.com/">Peter Ferrie</a> and myself while writing ChaCha20 and so few changes were made to implement Salsa20.

<strong>Context/State</strong>

The keystream buffer is 64-bytes or 512-bits which gets updated for each time the Salsa20 core is invoked.

<pre style='color:#000000;background:#ffffff;'><span style='color:#004a43;'>#</span><span style='color:#004a43;'>define</span><span style='color:#004a43;'> S20_BLK_LEN 64</span>

<span style='color:#800000;font-weight:bold;'>typedef</span> <span style='color:#800000;font-weight:bold;'>union</span> _s20_blk_t <span style='color:#800080;'>{</span>
  uint8_t  v8<span style='color:#808030;'>[</span>S20_BLK_LEN<span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  uint16_t v16<span style='color:#808030;'>[</span>S20_BLK_LEN<span style='color:#808030;'>/</span><span style='color:#008c00;'>2</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  uint32_t v32<span style='color:#808030;'>[</span>S20_BLK_LEN<span style='color:#808030;'>/</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  uint64_t v64<span style='color:#808030;'>[</span>S20_BLK_LEN<span style='color:#808030;'>/</span><span style='color:#008c00;'>8</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
<span style='color:#800080;'>}</span> s20_blk<span style='color:#800080;'>;</span>

<span style='color:#800000;font-weight:bold;'>typedef</span> <span style='color:#800000;font-weight:bold;'>struct</span> _s20_ctx_t <span style='color:#800080;'>{</span>
  s20_blk s<span style='color:#800080;'>;</span>
<span style='color:#800080;'>}</span> s20_ctx<span style='color:#800080;'>;</span>
</pre>

<strong>Key generation</strong>

This function expects 256-bit keys. The <a href="https://tinycrypt.wordpress.com/2015/12/04/asmcodes-chacha20/">ChaCha20 stream cipher</a> (Snuffle 2008) has a better design IMHO but hasn't received as much scrutiny as Salsa20 according to the author.

<pre style='color:#000000;background:#ffffff;'><span style='color:#696969;'>// setup the key, must be 256-bits with 64-bit nonce</span>
<span style='color:#800000;font-weight:bold;'>void</span> s20_setkey<span style='color:#808030;'>(</span>s20_ctx <span style='color:#808030;'>*</span>c<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>void</span> <span style='color:#808030;'>*</span>key<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>void</span> <span style='color:#808030;'>*</span>nonce<span style='color:#808030;'>)</span>
<span style='color:#800080;'>{</span>
  s20_blk <span style='color:#808030;'>*</span>iv<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>s20_blk<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>nonce<span style='color:#800080;'>;</span>
  s20_blk <span style='color:#808030;'>*</span>k<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>s20_blk<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>key<span style='color:#800080;'>;</span>
  
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> <span style='color:#008000;'>0x61707865</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> k<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>2</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> k<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>3</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> k<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>2</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> k<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>3</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>5</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> <span style='color:#008000;'>0x3320646E</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>6</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> iv<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>0</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>7</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> iv<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>8</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> <span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span> <span style='color:#008c00;'>9</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> <span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>10</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> <span style='color:#008000;'>0x79622D32</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>11</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> k<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>12</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> k<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>5</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>13</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> k<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>6</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>14</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> k<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>7</span><span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
  c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span><span style='color:#008c00;'>15</span><span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> <span style='color:#008000;'>0x6B206574</span><span style='color:#800080;'>;</span>
<span style='color:#800080;'>}</span>
</pre>

<pre style='color:#000000;background:#ffffff;'><span style='color:#e34adc;'>_s20_setkeyx:</span>
<span style='color:#e34adc;'>s20_setkeyx:</span>
    <span style='color:#800000;font-weight:bold;'>pushad</span>
    <span style='color:#800000;font-weight:bold;'>lea</span>    <span style='color:#000080;'>esi</span><span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>esp</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>32</span><span style='color:#008c00;'>+4</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>edi</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>push</span>   <span style='color:#000080;'>eax</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>ebx</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>
    <span style='color:#800000;font-weight:bold;'>pop</span>    <span style='color:#000080;'>esi</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>061707865h</span>
    <span style='color:#800000;font-weight:bold;'>cdq</span>
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#696969;'>; copy 16 bytes of 256-bit key</span>
    <span style='color:#800000;font-weight:bold;'>movsd</span>    
    <span style='color:#800000;font-weight:bold;'>movsd</span>    
    <span style='color:#800000;font-weight:bold;'>movsd</span>    
    <span style='color:#800000;font-weight:bold;'>movsd</span>    
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>03320646Eh</span>
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#696969;'>; copy 64-bit iv to 6,7</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>esi</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ebx</span>
    <span style='color:#800000;font-weight:bold;'>movsd</span>
    <span style='color:#800000;font-weight:bold;'>movsd</span>
    <span style='color:#696969;'>; zero 64-bit counter at 8,9</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>edx</span>
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#696969;'>; store 32-bits at 10</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>079622D32h</span>
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#696969;'>; store remainder of key at 11-14</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>esi</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ebx</span>
    <span style='color:#800000;font-weight:bold;'>movsd</span>    
    <span style='color:#800000;font-weight:bold;'>movsd</span>    
    <span style='color:#800000;font-weight:bold;'>movsd</span>    
    <span style='color:#800000;font-weight:bold;'>movsd</span>
    <span style='color:#696969;'>; store last 32-bits</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>06B206574h</span>
    <span style='color:#800000;font-weight:bold;'>stosd</span>
    <span style='color:#800000;font-weight:bold;'>popad</span>
    <span style='color:#800000;font-weight:bold;'>ret</span>
</pre>

<strong>Salsa20 Core</strong>

<blockquote>The 64-byte input x to Salsa20 is viewed in little-endian form as 16 words x0, x1, x2, ..., x15 in {0,1,...,2^32-1}. These 16 words are fed through 320 invertible modifications, where each modification changes one word. The resulting 16 words are added to the original x0, x1, x2, ..., x15 respectively modulo 2^32, producing, in little-endian form, the 64-byte output Salsa20(x).

Each modification involves xor'ing into one word a rotated version of the sum of two other words modulo 2^32. Thus the 320 modifications involve, overall, 320 additions, 320 xor's, and 320 rotations. The rotations are all by constant distances.

The entire series of modifications is a series of 10 identical double-rounds. Each double-round is a series of 2 rounds. Each round is a set of 4 parallel quarter-rounds. Each quarter-round modifies 4 words.

</blockquote>

<pre style='color:#000000;background:#ffffff;'><span style='color:#696969;'>// transforms block using ARX instructions</span>
<span style='color:#800000;font-weight:bold;'>void</span> QUARTERROUND<span style='color:#808030;'>(</span>s20_blk <span style='color:#808030;'>*</span>blk<span style='color:#808030;'>,</span> uint16_t idx<span style='color:#808030;'>)</span> 
<span style='color:#800080;'>{</span>
    uint32_t a<span style='color:#808030;'>,</span> b<span style='color:#808030;'>,</span> c<span style='color:#808030;'>,</span> d<span style='color:#800080;'>;</span>
    uint32_t <span style='color:#808030;'>*</span>x<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>uint32_t<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span><span style='color:#808030;'>&amp;</span>blk<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>v8<span style='color:#800080;'>;</span>
    
    a <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span>idx         <span style='color:#808030;'>&amp;</span> <span style='color:#008000;'>0xF</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
    b <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span><span style='color:#808030;'>(</span>idx <span style='color:#808030;'>&gt;</span><span style='color:#808030;'>&gt;</span>  <span style='color:#008c00;'>4</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>&amp;</span> <span style='color:#008000;'>0xF</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
    c <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span><span style='color:#808030;'>(</span>idx <span style='color:#808030;'>&gt;</span><span style='color:#808030;'>&gt;</span>  <span style='color:#008c00;'>8</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>&amp;</span> <span style='color:#008000;'>0xF</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
    d <span style='color:#808030;'>=</span> <span style='color:#808030;'>(</span><span style='color:#808030;'>(</span>idx <span style='color:#808030;'>&gt;</span><span style='color:#808030;'>&gt;</span> <span style='color:#008c00;'>12</span><span style='color:#808030;'>)</span> <span style='color:#808030;'>&amp;</span> <span style='color:#008000;'>0xF</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>

    x<span style='color:#808030;'>[</span>b<span style='color:#808030;'>]</span> <span style='color:#808030;'>^</span><span style='color:#808030;'>=</span> ROTL32<span style='color:#808030;'>(</span><span style='color:#808030;'>(</span>x<span style='color:#808030;'>[</span>a<span style='color:#808030;'>]</span> <span style='color:#808030;'>+</span> x<span style='color:#808030;'>[</span>d<span style='color:#808030;'>]</span><span style='color:#808030;'>)</span><span style='color:#808030;'>,</span> <span style='color:#008c00;'>7</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
    x<span style='color:#808030;'>[</span>c<span style='color:#808030;'>]</span> <span style='color:#808030;'>^</span><span style='color:#808030;'>=</span> ROTL32<span style='color:#808030;'>(</span><span style='color:#808030;'>(</span>x<span style='color:#808030;'>[</span>b<span style='color:#808030;'>]</span> <span style='color:#808030;'>+</span> x<span style='color:#808030;'>[</span>a<span style='color:#808030;'>]</span><span style='color:#808030;'>)</span><span style='color:#808030;'>,</span> <span style='color:#008c00;'>9</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
    
    x<span style='color:#808030;'>[</span>d<span style='color:#808030;'>]</span> <span style='color:#808030;'>^</span><span style='color:#808030;'>=</span> ROTL32<span style='color:#808030;'>(</span><span style='color:#808030;'>(</span>x<span style='color:#808030;'>[</span>c<span style='color:#808030;'>]</span> <span style='color:#808030;'>+</span> x<span style='color:#808030;'>[</span>b<span style='color:#808030;'>]</span><span style='color:#808030;'>)</span><span style='color:#808030;'>,</span><span style='color:#008c00;'>13</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
    x<span style='color:#808030;'>[</span>a<span style='color:#808030;'>]</span> <span style='color:#808030;'>^</span><span style='color:#808030;'>=</span> ROTL32<span style='color:#808030;'>(</span><span style='color:#808030;'>(</span>x<span style='color:#808030;'>[</span>d<span style='color:#808030;'>]</span> <span style='color:#808030;'>+</span> x<span style='color:#808030;'>[</span>c<span style='color:#808030;'>]</span><span style='color:#808030;'>)</span><span style='color:#808030;'>,</span><span style='color:#008c00;'>18</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
<span style='color:#800080;'>}</span>

<span style='color:#696969;'>// encrypt/decrypt 64 byte block</span>
<span style='color:#696969;'>// do not call directly, use s20_encrypt instead</span>
<span style='color:#800000;font-weight:bold;'>void</span> s20_core <span style='color:#808030;'>(</span>s20_ctx <span style='color:#808030;'>*</span>c<span style='color:#808030;'>,</span> uint8_t <span style='color:#808030;'>*</span>in<span style='color:#808030;'>,</span> uint32_t len<span style='color:#808030;'>)</span>
<span style='color:#800080;'>{</span>
    s20_blk x<span style='color:#800080;'>;</span>
    <span style='color:#800000;font-weight:bold;'>int</span>     i<span style='color:#808030;'>,</span> j<span style='color:#800080;'>;</span>

    <span style='color:#696969;'>// 16-bit integers of each index</span>
    uint16_t idx16<span style='color:#808030;'>[</span><span style='color:#008c00;'>8</span><span style='color:#808030;'>]</span><span style='color:#808030;'>=</span>
    <span style='color:#800080;'>{</span> <span style='color:#008000;'>0xC840</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>0x1D95</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>0x62EA</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>0xB73F</span><span style='color:#808030;'>,</span> 
      <span style='color:#008000;'>0x3210</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>0x4765</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>0x98BA</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>0xEDCF</span> <span style='color:#800080;'>}</span><span style='color:#800080;'>;</span>
    
    <span style='color:#696969;'>// copy state to local space</span>
    <span style='color:#800000;font-weight:bold;'>for</span> <span style='color:#808030;'>(</span>i<span style='color:#808030;'>=</span><span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>&lt;</span><span style='color:#008c00;'>16</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>+</span><span style='color:#808030;'>+</span><span style='color:#808030;'>)</span> <span style='color:#800080;'>{</span> 
      x<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span>i<span style='color:#808030;'>]</span> <span style='color:#808030;'>=</span> c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span>i<span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
    <span style='color:#800080;'>}</span>
    <span style='color:#696969;'>// apply 20 rounds</span>
    <span style='color:#800000;font-weight:bold;'>for</span> <span style='color:#808030;'>(</span>i<span style='color:#808030;'>=</span><span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>&lt;</span><span style='color:#008c00;'>20</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>+</span><span style='color:#808030;'>=</span><span style='color:#008c00;'>2</span><span style='color:#808030;'>)</span> <span style='color:#800080;'>{</span>
      <span style='color:#800000;font-weight:bold;'>for</span> <span style='color:#808030;'>(</span>j<span style='color:#808030;'>=</span><span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span> j<span style='color:#808030;'>&lt;</span><span style='color:#008c00;'>8</span><span style='color:#800080;'>;</span> j<span style='color:#808030;'>+</span><span style='color:#808030;'>+</span><span style='color:#808030;'>)</span> <span style='color:#800080;'>{</span>
        QUARTERROUND<span style='color:#808030;'>(</span><span style='color:#808030;'>&amp;</span>x<span style='color:#808030;'>,</span> idx16<span style='color:#808030;'>[</span>j<span style='color:#808030;'>]</span><span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
      <span style='color:#800080;'>}</span>
    <span style='color:#800080;'>}</span>
    <span style='color:#696969;'>// add state to x</span>
    <span style='color:#800000;font-weight:bold;'>for</span> <span style='color:#808030;'>(</span>i<span style='color:#808030;'>=</span><span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>&lt;</span><span style='color:#008c00;'>16</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>+</span><span style='color:#808030;'>+</span><span style='color:#808030;'>)</span> <span style='color:#800080;'>{</span>
      x<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span>i<span style='color:#808030;'>]</span> <span style='color:#808030;'>+</span><span style='color:#808030;'>=</span> c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v32<span style='color:#808030;'>[</span>i<span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
    <span style='color:#800080;'>}</span>
    <span style='color:#696969;'>// xor input with x</span>
    <span style='color:#800000;font-weight:bold;'>for</span> <span style='color:#808030;'>(</span>i<span style='color:#808030;'>=</span><span style='color:#008c00;'>0</span><span style='color:#800080;'>;</span> i<span style='color:#808030;'>&lt;</span>len<span style='color:#800080;'>;</span> i<span style='color:#808030;'>+</span><span style='color:#808030;'>+</span><span style='color:#808030;'>)</span> <span style='color:#800080;'>{</span>
      <span style='color:#808030;'>(</span><span style='color:#808030;'>(</span>uint8_t<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>in<span style='color:#808030;'>)</span><span style='color:#808030;'>[</span>i<span style='color:#808030;'>]</span> <span style='color:#808030;'>^</span><span style='color:#808030;'>=</span> x<span style='color:#808030;'>.</span>v8<span style='color:#808030;'>[</span>i<span style='color:#808030;'>]</span><span style='color:#800080;'>;</span>
    <span style='color:#800080;'>}</span>
    <span style='color:#696969;'>// update block counter</span>
    c<span style='color:#808030;'>-</span><span style='color:#808030;'>&gt;</span>s<span style='color:#808030;'>.</span>v64<span style='color:#808030;'>[</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span><span style='color:#808030;'>+</span><span style='color:#808030;'>+</span><span style='color:#800080;'>;</span>
    <span style='color:#696969;'>// stopping at 2^70 bytes per nonce is user's responsibility</span>
<span style='color:#800080;'>}</span>
</pre>

<pre style='color:#000000;background:#ffffff;'><span style='color:#004a43;'>%define</span><span style='color:#004a43;'> a eax</span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> b ebx</span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> c edx</span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> d esi</span>
<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> x edi</span>

<span style='color:#004a43;'>%define</span><span style='color:#004a43;'> t0 ebp</span>

<span style='color:#696969;'>; void QUARTERROUND(s20_blk *blk, uint16_t index)</span>
<span style='color:#696969;'>; expects edi points to x array</span>
<span style='color:#e34adc;'>QUARTERROUND:</span>
    <span style='color:#800000;font-weight:bold;'>pushad</span>
    <span style='color:#800000;font-weight:bold;'>push</span>   a                <span style='color:#696969;'>; save eax</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>ah</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>al</span>
    <span style='color:#800000;font-weight:bold;'>aam</span>    <span style='color:#008c00;'>16</span>
    
    <span style='color:#800000;font-weight:bold;'>movzx</span>  d<span style='color:#808030;'>,</span> <span style='color:#000080;'>ah</span>
    <span style='color:#800000;font-weight:bold;'>movzx</span>  <span style='color:#004a43;'>c</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>al</span>

    <span style='color:#800000;font-weight:bold;'>pop</span>    a
    <span style='color:#800000;font-weight:bold;'>aam</span>    <span style='color:#008c00;'>16</span>
    
    <span style='color:#800000;font-weight:bold;'>movzx</span>  b<span style='color:#808030;'>,</span> <span style='color:#000080;'>ah</span>
    <span style='color:#800000;font-weight:bold;'>movzx</span>  a<span style='color:#808030;'>,</span> <span style='color:#000080;'>al</span>

    <span style='color:#800000;font-weight:bold;'>lea</span>    a<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>x<span style='color:#808030;'>+</span>a<span style='color:#808030;'>*</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>lea</span>    b<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>x<span style='color:#808030;'>+</span>b<span style='color:#808030;'>*</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>lea</span>    <span style='color:#004a43;'>c</span><span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>x<span style='color:#808030;'>+</span><span style='color:#004a43;'>c</span><span style='color:#808030;'>*</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>lea</span>    d<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>x<span style='color:#808030;'>+</span>d<span style='color:#808030;'>*</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span>

    <span style='color:#696969;'>; load ecx with rotate values</span>
    <span style='color:#696969;'>; 16, 12, 8, 7</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>ecx</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>0120D0907h</span>
<span style='color:#e34adc;'>s20_q0:</span>
    <span style='color:#696969;'>; x[b] ^= ROTL32((x[a] + x[d]), 7);</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    t0<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>a<span style='color:#808030;'>]</span>           <span style='color:#696969;'>; ebp=x[a]</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    t0<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>d<span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>rol</span>    t0<span style='color:#808030;'>,</span> <span style='color:#000080;'>cl</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    <span style='color:#808030;'>[</span>b<span style='color:#808030;'>]</span><span style='color:#808030;'>,</span> t0
    
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>cl</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ch</span>
    
    <span style='color:#800000;font-weight:bold;'>mov</span>    t0<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>b<span style='color:#808030;'>]</span>           <span style='color:#696969;'>; ebp=x[b]</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    t0<span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span>a<span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>rol</span>    t0<span style='color:#808030;'>,</span> <span style='color:#000080;'>cl</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    <span style='color:#808030;'>[</span><span style='color:#004a43;'>c</span><span style='color:#808030;'>]</span><span style='color:#808030;'>,</span> t0
    
    <span style='color:#800000;font-weight:bold;'>xchg</span>   a<span style='color:#808030;'>,</span> <span style='color:#004a43;'>c</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   b<span style='color:#808030;'>,</span> d
    
    <span style='color:#800000;font-weight:bold;'>shr</span>    <span style='color:#000080;'>ecx</span><span style='color:#808030;'>,</span> <span style='color:#008c00;'>16</span>
    <span style='color:#800000;font-weight:bold;'>jnz</span>    <span style='color:#e34adc;'>s20_q0</span>
    
    <span style='color:#800000;font-weight:bold;'>popad</span>
    <span style='color:#800000;font-weight:bold;'>ret</span>
  
<span style='color:#696969;'>; void s20_corex (s20_ctx *ctx, void *in, uint32_t len)</span>
<span style='color:#696969;'>; do not call directly</span>
<span style='color:#696969;'>; expects state in ebx, length in eax, input in edx</span>
<span style='color:#e34adc;'>_s20_corex:</span>
<span style='color:#e34adc;'>s20_corex:</span>
    <span style='color:#800000;font-weight:bold;'>pushad</span>

    <span style='color:#696969;'>; allocate 64-bytes local space, x</span>
    <span style='color:#800000;font-weight:bold;'>push</span>   <span style='color:#008c00;'>64</span>
    <span style='color:#800000;font-weight:bold;'>pop</span>    <span style='color:#000080;'>ecx</span>
    <span style='color:#800000;font-weight:bold;'>sub</span>    <span style='color:#000080;'>esp</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ecx</span>
    
    <span style='color:#696969;'>; copy state to x</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>edi</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>esp</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>esi</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ebx</span>
    <span style='color:#800000;font-weight:bold;'>rep</span>    <span style='color:#800000;font-weight:bold;'>movsb</span>

    <span style='color:#696969;'>; move x into edi</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>edi</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>esp</span>
    <span style='color:#800000;font-weight:bold;'>push</span>   <span style='color:#000080;'>eax</span>
    <span style='color:#800000;font-weight:bold;'>push</span>   <span style='color:#008c00;'>20</span><span style='color:#808030;'>/</span><span style='color:#008c00;'>2</span>  <span style='color:#696969;'>; 20 rounds</span>
    <span style='color:#800000;font-weight:bold;'>pop</span>    <span style='color:#000080;'>ebp</span>
<span style='color:#e34adc;'>s20_c0:</span>
    <span style='color:#696969;'>; load indexes</span>
    <span style='color:#800000;font-weight:bold;'>call</span>   <span style='color:#e34adc;'>s20_c1</span>
    <span style='color:#004a43;'>dw</span> <span style='color:#008000;'>0C840h</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>01D95h</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>062EAh</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>0B73Fh</span>
    <span style='color:#004a43;'>dw</span> <span style='color:#008000;'>03210h</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>04765h</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>098BAh</span><span style='color:#808030;'>,</span> <span style='color:#008000;'>0EDCFh</span>
<span style='color:#e34adc;'>s20_c1:</span>
    <span style='color:#800000;font-weight:bold;'>pop</span>    <span style='color:#000080;'>esi</span>  <span style='color:#696969;'>; pointer to indexes</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>cl</span><span style='color:#808030;'>,</span> <span style='color:#008c00;'>8</span>
<span style='color:#e34adc;'>s20_c2:</span>
    <span style='color:#800000;font-weight:bold;'>lodsw</span>
    <span style='color:#800000;font-weight:bold;'>call</span>   <span style='color:#e34adc;'>QUARTERROUND</span>
    <span style='color:#800000;font-weight:bold;'>loop</span>   <span style='color:#e34adc;'>s20_c2</span>
    <span style='color:#800000;font-weight:bold;'>dec</span>    <span style='color:#000080;'>ebp</span>
    <span style='color:#800000;font-weight:bold;'>jnz</span>    <span style='color:#e34adc;'>s20_c0</span>
    
    <span style='color:#696969;'>; add state to x</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>cl</span><span style='color:#808030;'>,</span> <span style='color:#008c00;'>16</span>
<span style='color:#e34adc;'>s20_c3:</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>ebx</span><span style='color:#808030;'>+</span><span style='color:#000080;'>ecx</span><span style='color:#808030;'>*</span><span style='color:#008c00;'>4</span><span style='color:#008c00;'>-4</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    <span style='color:#808030;'>[</span><span style='color:#000080;'>edi</span><span style='color:#808030;'>+</span><span style='color:#000080;'>ecx</span><span style='color:#808030;'>*</span><span style='color:#008c00;'>4</span><span style='color:#008c00;'>-4</span><span style='color:#808030;'>]</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>
    <span style='color:#800000;font-weight:bold;'>loop</span>   <span style='color:#e34adc;'>s20_c3</span>

    <span style='color:#696969;'>; xor input with x</span>
    <span style='color:#800000;font-weight:bold;'>pop</span>    <span style='color:#000080;'>ecx</span>               <span style='color:#696969;'>; ecx=len</span>
<span style='color:#e34adc;'>s20_c4:</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>al</span><span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>byte</span><span style='color:#808030;'>[</span><span style='color:#000080;'>edi</span><span style='color:#808030;'>+</span><span style='color:#000080;'>ecx</span><span style='color:#808030;'>-</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    <span style='color:#800000;font-weight:bold;'>byte</span><span style='color:#808030;'>[</span><span style='color:#000080;'>edx</span><span style='color:#808030;'>+</span><span style='color:#000080;'>ecx</span><span style='color:#808030;'>-</span><span style='color:#008c00;'>1</span><span style='color:#808030;'>]</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>al</span>
    <span style='color:#800000;font-weight:bold;'>loop</span>   <span style='color:#e34adc;'>s20_c4</span>
    
    <span style='color:#696969;'>; update block counter</span>
    <span style='color:#800000;font-weight:bold;'>stc</span>
    <span style='color:#800000;font-weight:bold;'>adc</span>    <span style='color:#800000;font-weight:bold;'>dword</span><span style='color:#808030;'>[</span><span style='color:#000080;'>ebx</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>8</span><span style='color:#808030;'>*</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ecx</span>
    <span style='color:#800000;font-weight:bold;'>adc</span>    <span style='color:#800000;font-weight:bold;'>dword</span><span style='color:#808030;'>[</span><span style='color:#000080;'>ebx</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>9</span><span style='color:#808030;'>*</span><span style='color:#008c00;'>4</span><span style='color:#808030;'>]</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ecx</span>
    
    <span style='color:#696969;'>; free stack</span>
    <span style='color:#800000;font-weight:bold;'>popad</span>
    <span style='color:#800000;font-weight:bold;'>popad</span>
    <span style='color:#696969;'>; restore registers</span>
    <span style='color:#800000;font-weight:bold;'>popad</span>
    <span style='color:#800000;font-weight:bold;'>ret</span>
</pre>

<strong>Encryption and Decryption</strong>

The same function is used to encrypt/decrypt providing the same key and nonce are used during key setup.

<pre style='color:#000000;background:#ffffff;'><span style='color:#696969;'>// encrypt stream of bytes</span>
<span style='color:#800000;font-weight:bold;'>void</span> s20_crypt <span style='color:#808030;'>(</span>s20_ctx <span style='color:#808030;'>*</span>c<span style='color:#808030;'>,</span> <span style='color:#800000;font-weight:bold;'>void</span> <span style='color:#808030;'>*</span>in<span style='color:#808030;'>,</span> uint32_t len<span style='color:#808030;'>)</span> 
<span style='color:#800080;'>{</span>
    uint32_t r<span style='color:#800080;'>;</span>
    uint8_t  <span style='color:#808030;'>*</span>p<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>uint8_t<span style='color:#808030;'>*</span><span style='color:#808030;'>)</span>in<span style='color:#800080;'>;</span>
    
    <span style='color:#800000;font-weight:bold;'>while</span> <span style='color:#808030;'>(</span>len<span style='color:#808030;'>)</span> <span style='color:#800080;'>{</span>
      r<span style='color:#808030;'>=</span><span style='color:#808030;'>(</span>len<span style='color:#808030;'>&gt;</span><span style='color:#008c00;'>64</span><span style='color:#808030;'>)</span> <span style='color:#800080;'>?</span> <span style='color:#008c00;'>64</span> <span style='color:#800080;'>:</span> len<span style='color:#800080;'>;</span>
      s20_core<span style='color:#808030;'>(</span>c<span style='color:#808030;'>,</span> p<span style='color:#808030;'>,</span> r<span style='color:#808030;'>)</span><span style='color:#800080;'>;</span>
      len <span style='color:#808030;'>-</span><span style='color:#808030;'>=</span> r<span style='color:#800080;'>;</span>
      p <span style='color:#808030;'>+</span><span style='color:#808030;'>=</span> r<span style='color:#800080;'>;</span>
    <span style='color:#800080;'>}</span>
<span style='color:#800080;'>}</span>
</pre>

<pre style='color:#000000;background:#ffffff;'><span style='color:#e34adc;'>_s20_cryptx:</span>
<span style='color:#e34adc;'>s20_cryptx:</span>
    <span style='color:#800000;font-weight:bold;'>pushad</span>
    <span style='color:#800000;font-weight:bold;'>lea</span>    <span style='color:#000080;'>esi</span><span style='color:#808030;'>,</span> <span style='color:#808030;'>[</span><span style='color:#000080;'>esp</span><span style='color:#808030;'>+</span><span style='color:#008c00;'>32</span><span style='color:#008c00;'>+4</span><span style='color:#808030;'>]</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>ebx</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>edx</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>
    <span style='color:#800000;font-weight:bold;'>lodsd</span>
    <span style='color:#800000;font-weight:bold;'>xchg</span>   <span style='color:#000080;'>ecx</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>
    <span style='color:#800000;font-weight:bold;'>jecxz</span>  <span style='color:#e34adc;'>s20_l1</span>            <span style='color:#696969;'>; exit if len==0</span>
    <span style='color:#800000;font-weight:bold;'>xor</span>    <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>          <span style='color:#696969;'>; r=0</span>
<span style='color:#e34adc;'>s20_l0:</span>
    <span style='color:#800000;font-weight:bold;'>mov</span>    <span style='color:#000080;'>al</span><span style='color:#808030;'>,</span> <span style='color:#008c00;'>64</span>
    <span style='color:#800000;font-weight:bold;'>cmp</span>    <span style='color:#000080;'>ecx</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>          <span style='color:#696969;'>; eax=len &lt; 64 ? len : 64</span>
    <span style='color:#800000;font-weight:bold;'>cmovb</span>  <span style='color:#000080;'>eax</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>ecx</span>
    <span style='color:#800000;font-weight:bold;'>call</span>   <span style='color:#e34adc;'>s20_corex</span>
    <span style='color:#800000;font-weight:bold;'>add</span>    <span style='color:#000080;'>edx</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>          <span style='color:#696969;'>; p += r;</span>
    <span style='color:#800000;font-weight:bold;'>sub</span>    <span style='color:#000080;'>ecx</span><span style='color:#808030;'>,</span> <span style='color:#000080;'>eax</span>          <span style='color:#696969;'>; len -= r;</span>
    <span style='color:#800000;font-weight:bold;'>jnz</span>    <span style='color:#e34adc;'>s20_l0</span>
<span style='color:#e34adc;'>s20_l1:</span>
    <span style='color:#800000;font-weight:bold;'>popad</span>
    <span style='color:#800000;font-weight:bold;'>ret</span>
</pre>

<strong>Summary</strong>

<table>
<tr>
<th>architecture</th><th>size</th>
</tr>
<tr><td>x86</td><td>245</td></tr>
<tr><td>x64</td><td>n/a</td></tr>
</table>

For source code and any future updates, please refere to code <a href="https://github.com/odzhan/tinycrypt/tree/master/stream/salsa">here</a>.


